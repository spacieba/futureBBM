<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GP Basketball Manager</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        /* === AVATARS ANIMÃ‰S DES FRANCHISES === */

        /* Minotaurs - Taureau qui charge */
        .minotaur-avatar {
            display: inline-block;
            font-size: 3rem;
            animation: charge 2s ease-in-out infinite;
            filter: drop-shadow(0 0 10px rgba(255, 0, 0, 0.5));
        }

        @keyframes charge {
            0%, 100% { transform: translateX(0) rotate(0deg); }
            50% { transform: translateX(-3px) rotate(-2deg); }
        }

        /* Krakens - Tentacules qui ondulent */
        .kraken-avatar {
            display: inline-block;
            font-size: 3rem;
            animation: tentacles 3s ease-in-out infinite;
            filter: drop-shadow(0 0 10px rgba(0, 100, 255, 0.5));
        }

        @keyframes tentacles {
            0%, 100% { transform: rotate(0deg) scale(1); }
            33% { transform: rotate(2deg) scale(1.05); }
            66% { transform: rotate(-2deg) scale(0.95); }
        }

        /* Phoenix - Flammes qui dansent */
        .phoenix-avatar {
            display: inline-block;
            font-size: 3rem;
            animation: flames 2s ease-in-out infinite;
            filter: drop-shadow(0 0 15px rgba(255, 165, 0, 0.7));
        }

        @keyframes flames {
            0%, 100% { transform: translateY(0px) scale(1); }
            25% { transform: translateY(-2px) scale(1.1); }
            75% { transform: translateY(1px) scale(0.9); }
        }

        /* Werewolves - Yeux qui brillent */
        .werewolf-avatar {
            display: inline-block;
            font-size: 3rem;
            animation: glow 4s ease-in-out infinite;
            filter: drop-shadow(0 0 10px rgba(0, 255, 0, 0.4));
        }

        @keyframes glow {
            0%, 100% { filter: drop-shadow(0 0 10px rgba(0, 255, 0, 0.4)); }
            50% { filter: drop-shadow(0 0 20px rgba(0, 255, 0, 0.8)) brightness(1.2); }
        }

        /* Effet de hover pour tous les avatars */
        .franchise-avatar:hover {
            transform: scale(1.2);
            transition: transform 0.3s ease;
            cursor: pointer;
        }

        /* Particules de fond optionnelles */
        .franchise-card {
            position: relative;
            overflow: hidden;
        }

        .franchise-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 1px, transparent 1px);
            background-size: 20px 20px;
            animation: sparkle 10s linear infinite;
            pointer-events: none;
        }

        @keyframes sparkle {
            0% { transform: translate(0, 0) rotate(0deg); }
            100% { transform: translate(-20px, -20px) rotate(360deg); }
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;

        // DÃ©finition des badges individuels
        const individualBadges = {
  // === SÃ‰RIES (4 badges) ===
  hotStreak: {
    id: 'hot_streak',
    name: 'Hot Streak',
    emoji: 'ğŸ”¥',
    description: '5 actions positives d\'affilÃ©e',
    points: 5,
    rarity: 'bronze'
  },
  tsunami: {
    id: 'tsunami',
    name: 'Tsunami',
    emoji: 'ğŸŒŠ',
    description: '10 actions positives d\'affilÃ©e',
    points: 10,
    rarity: 'argent'
  },
  unstoppable: {
    id: 'unstoppable',
    name: 'Unstoppable',
    emoji: 'ğŸš€',
    description: '15 actions positives d\'affilÃ©e',
    points: 20,
    rarity: 'or'
  },
  onFire: {
    id: 'on_fire',
    name: 'On Fire',
    emoji: 'ğŸ’ª',
    description: '2 Hardworker en 2 semaines',
    points: 10,
    rarity: 'argent'
  },
  
  // === PERSÃ‰VÃ‰RANCE (2 badges) ===
  phoenix: {
    id: 'phoenix',
    name: 'Phoenix',
    emoji: 'ğŸ¦…',
    description: 'Remonter de -50 Ã  +50 points',
    points: 20,
    rarity: 'or'
  },
  marathonRunner: {
    id: 'marathon_runner',
    name: 'Marathon Runner',
    emoji: 'ğŸƒ',
    description: 'Actions positives 5 jours consÃ©cutifs',
    points: 5,
    rarity: 'bronze'
  },
  
  // === SOCIAUX/Ã‰QUIPE (3 badges) ===
  teamCaptain: {
    id: 'team_captain',
    name: 'Team Captain',
    emoji: 'ğŸ‘‘',
    description: 'Meilleur de sa franchise pendant 1 semaine',
    points: 10,
    rarity: 'argent'
  },
  veteran: {
    id: 'veteran',
    name: 'Veteran',
    emoji: 'ğŸ–ï¸',
    description: 'Top 3 de sa franchise pendant 2 mois',
    points: 20,
    rarity: 'or'
  },
  teamPlayer: {
    id: 'team_player',
    name: 'Team Player',
    emoji: 'ğŸ¤',
    description: 'Sa franchise gagne le + de points en 1 semaine',
    points: 5,
    rarity: 'bronze'
  },
  
  // === SPÃ‰CIAUX & RARES (3 badges) ===
  showtime: {
    id: 'showtime',
    name: 'Showtime',
    emoji: 'ğŸª',
    description: 'Recevoir FÃ©licitations 3 fois',
    points: 35,
    rarity: 'diamant'
  },
  halloweenSpirit: {
    id: 'halloween_spirit',
    name: 'Halloween Spirit',
    emoji: 'ğŸƒ',
    description: '3 Actions positives semaine Halloween',
    points: 50,
    rarity: 'legendaire'
  },
  christmasMagic: {
    id: 'christmas_magic',
    name: 'Christmas Magic',
    emoji: 'ğŸ„',
    description: 'Actions positives pendant les fÃªtes',
    points: 50,
    rarity: 'legendaire'
  }
};

       const collectiveBadges = {

  // === PERFORMANCES (4 badges) ===
  rocketLaunch: {
    id: 'rocket_launch',
    name: 'Rocket Launch',
    emoji: 'ğŸš€',
    description: '+80 points collectifs en 1 semaine',
    points: 20,
    rarity: 'bronze'
  },
  tidalWave: {
    id: 'tidal_wave',
    name: 'Tidal Wave',
    emoji: 'ğŸŒŠ',
    description: '+200 points collectifs en 1 mois',
    points: 100,
    rarity: 'or'
  },
  lightningStrike: {
    id: 'lightning_strike',
    name: 'Lightning Strike',
    emoji: 'âš¡',
    description: 'Tous les membres gagnent points mÃªme jour',
    points: 20,
    rarity: 'bronze'
  },
  houseOnFire: {
    id: 'house_on_fire',
    name: 'House on Fire',
    emoji: 'ğŸ”¥',
    description: '80% membres actions positives en 1 semaine',
    points: 50,
    rarity: 'argent'
  },
  
  // === SOLIDARITÃ‰ (4 badges) ===
  unitedWeStand: {
    id: 'united_we_stand',
    name: 'United We Stand',
    emoji: 'ğŸ¤',
    description: 'Aucun membre nÃ©gatif pendant 2 semaines',
    points: 50,
    rarity: 'argent'
  },
  perfectBalance: {
    id: 'perfect_balance',
    name: 'Perfect Balance',
    emoji: 'âš–ï¸',
    description: 'Tous membres entre 25-75 points',
    points: 100,
    rarity: 'or'
  },
  harmony: {
    id: 'harmony',
    name: 'Harmony',
    emoji: 'ğŸŒˆ',
    description: 'Ã‰cart <50 points entre 1er et dernier',
    points: 50,
    rarity: 'argent'
  }
};

        // Fonction pour obtenir la couleur selon la raretÃ©
        const getRarityColor = (rarity) => {
          switch(rarity) {
            case 'common': return 'border-gray-400';
            case 'rare': return 'border-blue-400';
            case 'epic': return 'border-purple-400';
            case 'legendary': return 'border-yellow-400';
            default: return 'border-gray-400';
          }
        };

        // Composant ProgressionChart
const ProgressionChart = ({ playerName, onClose }) => {
  console.log("ProgressionChart component loaded for:", playerName); 
  const [chartData, setChartData] = useState(null);
  const [period, setPeriod] = useState('30'); // Par dÃ©faut 30 jours
  const [loading, setLoading] = useState(true);
  const [chartInstance, setChartInstance] = useState(null);

  // Charger les donnÃ©es
  const loadChartData = async (days) => {
    setLoading(true);
    try {
      const response = await fetch(`/api/progression/${encodeURIComponent(playerName)}?days=${days}`);
      const data = await response.json();
      setChartData(data);
      
      // Mettre Ã  jour le graphique
      if (chartInstance) {
        updateChart(data);
      }
    } catch (error) {
      console.error('Erreur lors du chargement des donnÃ©es:', error);
    }
    setLoading(false);
  };

  // CrÃ©er le graphique
  const createChart = (data) => {
    const ctx = document.getElementById('playerProgressionChart').getContext('2d');
    
    // DÃ©truire l'ancien graphique s'il existe
    if (chartInstance) {
      chartInstance.destroy();
    }
    
    const newChart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: data.data.map(d => {
          const date = new Date(d.date);
          return date.toLocaleDateString('fr-FR', { day: '2-digit', month: 'short' });
        }),
        datasets: [
          {
            label: 'Score cumulÃ©',
            data: data.data.map(d => d.cumulative_score),
            borderColor: 'rgb(59, 130, 246)',
            backgroundColor: 'rgba(59, 130, 246, 0.1)',
            tension: 0.3,
            fill: true,
            pointRadius: 4,
            pointHoverRadius: 6
          },
          {
            label: 'Points du jour',
            data: data.data.map(d => d.daily_points),
            borderColor: d => d.y > 0 ? 'rgb(34, 197, 94)' : 'rgb(239, 68, 68)',
            backgroundColor: d => d.y > 0 ? 'rgba(34, 197, 94, 0.1)' : 'rgba(239, 68, 68, 0.1)',
            type: 'bar',
            yAxisID: 'y1',
            borderWidth: 2
          }
        ]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        interaction: {
          mode: 'index',
          intersect: false,
        },
        plugins: {
          title: {
            display: true,
            text: `Progression de ${playerName}`,
            font: {
              size: 16,
              weight: 'bold'
            }
          },
          legend: {
            display: true,
            position: 'top',
          },
          tooltip: {
            callbacks: {
              afterLabel: function(context) {
                if (context.datasetIndex === 0) {
                  const dataIndex = context.dataIndex;
                  const dayData = data.data[dataIndex];
                  return [
                    `Actions: ${dayData.actions_count}`,
                    `Points positifs: +${dayData.positive_points}`,
                    `Points nÃ©gatifs: ${dayData.negative_points}`
                  ];
                }
                return [];
              }
            }
          }
        },
        scales: {
          y: {
            type: 'linear',
            display: true,
            position: 'left',
            title: {
              display: true,
              text: 'Score cumulÃ©'
            },
            grid: {
              color: 'rgba(255, 255, 255, 0.1)'
            }
          },
          y1: {
            type: 'linear',
            display: true,
            position: 'right',
            title: {
              display: true,
              text: 'Points du jour'
            },
            grid: {
              drawOnChartArea: false,
            },
          },
          x: {
            grid: {
              color: 'rgba(255, 255, 255, 0.1)'
            }
          }
        }
      }
    });
    
    setChartInstance(newChart);
  };

  // Mettre Ã  jour le graphique
  const updateChart = (data) => {
    if (!chartInstance) return;
    
    chartInstance.data.labels = data.data.map(d => {
      const date = new Date(d.date);
      return date.toLocaleDateString('fr-FR', { day: '2-digit', month: 'short' });
    });
    
    chartInstance.data.datasets[0].data = data.data.map(d => d.cumulative_score);
    chartInstance.data.datasets[1].data = data.data.map(d => d.daily_points);
    
    chartInstance.update();
  };

  useEffect(() => {
    loadChartData(period);
  }, [period]);

  useEffect(() => {
    if (chartData && !loading) {
      setTimeout(() => createChart(chartData), 100);
    }
    
    return () => {
      if (chartInstance) {
        chartInstance.destroy();
      }
    };
  }, [chartData, loading]);

  return (
    <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
      <div className="bg-white rounded-xl p-6 max-w-4xl w-full max-h-[90vh] overflow-y-auto">
        <div className="flex justify-between items-center mb-4">
          <h3 className="text-2xl font-bold">ğŸ“ˆ Progression de {playerName}</h3>
          <button
            onClick={onClose}
            className="text-gray-500 hover:text-gray-700 text-2xl"
          >
            Ã—
          </button>
        </div>
        
        {/* SÃ©lecteur de pÃ©riode */}
        <div className="flex space-x-2 mb-6">
          <button
            onClick={() => setPeriod('7')}
            className={`px-4 py-2 rounded-lg transition-colors ${
              period === '7' 
                ? 'bg-blue-600 text-white' 
                : 'bg-gray-200 hover:bg-gray-300'
            }`}
          >
            7 jours
          </button>
          <button
            onClick={() => setPeriod('15')}
            className={`px-4 py-2 rounded-lg transition-colors ${
              period === '15' 
                ? 'bg-blue-600 text-white' 
                : 'bg-gray-200 hover:bg-gray-300'
            }`}
          >
            15 jours
          </button>
          <button
            onClick={() => setPeriod('30')}
            className={`px-4 py-2 rounded-lg transition-colors ${
              period === '30' 
                ? 'bg-blue-600 text-white' 
                : 'bg-gray-200 hover:bg-gray-300'
            }`}
          >
            30 jours
          </button>
          <button
            onClick={() => setPeriod('all')}
            className={`px-4 py-2 rounded-lg transition-colors ${
              period === 'all' 
                ? 'bg-blue-600 text-white' 
                : 'bg-gray-200 hover:bg-gray-300'
            }`}
          >
            Tout
          </button>
        </div>
        
        {/* Zone du graphique */}
        {loading ? (
          <div className="flex items-center justify-center h-96">
            <div className="text-lg">â³ Chargement...</div>
          </div>
        ) : (
          <>
            <div className="bg-gray-50 p-4 rounded-lg" style={{ height: '400px' }}>
              <canvas id="playerProgressionChart"></canvas>
            </div>
            
            {/* Statistiques rÃ©sumÃ©es */}
            {chartData && (
              <div className="grid grid-cols-3 gap-4 mt-6">
                <div className="bg-blue-50 p-4 rounded-lg text-center">
                  <div className="text-2xl font-bold text-blue-600">
                    {chartData.summary.totalPoints > 0 ? '+' : ''}{chartData.summary.totalPoints}
                  </div>
                  <div className="text-sm text-gray-600">Points sur la pÃ©riode</div>
                </div>
                <div className="bg-green-50 p-4 rounded-lg text-center">
                  <div className="text-2xl font-bold text-green-600">
                    {chartData.summary.totalActions}
                  </div>
                  <div className="text-sm text-gray-600">Actions totales</div>
                </div>
                <div className="bg-purple-50 p-4 rounded-lg text-center">
                  <div className="text-2xl font-bold text-purple-600">
                    {chartData.summary.activeDays}
                  </div>
                  <div className="text-sm text-gray-600">Jours actifs</div>
                </div>
              </div>
            )}
          </>
        )}
      </div>
    </div>
  );
};
        
        // Composant BadgeDisplay
        const BadgeDisplay = ({ badges }) => {
  if (!badges || badges.length === 0) return null;
  
  return (
    <div className="flex flex-wrap gap-1 mt-2">
      {badges.map((badge, index) => (
        <span 
          key={badge.badge_id || badge.id || index} 
          className="text-xl" 
          title={`${badge.badge_name || badge.name} - ${badge.description || ''}`}
        >
          {badge.badge_emoji || badge.emoji || 'ğŸ…'}
        </span>
      ))}
    </div>
  );
};

        // Composant NotificationSystem
        const NotificationSystem = ({ notifications }) => {
          if (!notifications || notifications.length === 0) return null;
          
          return (
            <div className="fixed top-4 right-4 z-50 space-y-2 max-w-sm">
              {notifications.map((notif, index) => (
                <div
                  key={index}
                  className="bg-gradient-to-r from-purple-600 to-blue-600 text-white px-6 py-3 rounded-lg shadow-2xl animate-pulse"
                >
                  {notif}
                </div>
              ))}
            </div>
          );
        };

        const App = () => {
          const [currentView, setCurrentView] = useState('home');
          const [userType, setUserType] = useState(null);
          const [players, setPlayers] = useState([]);
          const [expandedDropdown, setExpandedDropdown] = useState(null);
          const [selectedPlayerHistory, setSelectedPlayerHistory] = useState(null);
          const [playerHistory, setPlayerHistory] = useState([]);
          const [loading, setLoading] = useState(false);
          const [password, setPassword] = useState('');
          const [loginError, setLoginError] = useState('');
          const [teacherName, setTeacherName] = useState('');
          const [selectedStudent, setSelectedStudent] = useState('');
          const [newStudentName, setNewStudentName] = useState('');
          const [newStudentFranchise, setNewStudentFranchise] = useState('Minotaurs');
          const [searchName, setSearchName] = useState('');
          const [foundPlayer, setFoundPlayer] = useState(null);
          const [searchHistory, setSearchHistory] = useState([]);
          const [graphPeriod, setGraphPeriod] = useState('15days'); // '15days', '3months', ou 'all'
          const [showEvolutionChart, setShowEvolutionChart] = useState(false);
          const [chartData, setChartData] = useState(null);
          const [chartType, setChartType] = useState('player');
          // Ã‰tats pour les badges
          const [playerBadges, setPlayerBadges] = useState({});
          const [franchiseBadges, setFranchiseBadges] = useState({});
          const [notifications, setNotifications] = useState([]);
            // Ã‰tats pour le graphique de progression
const [showProgressionChart, setShowProgressionChart] = useState(false);
const [selectedChartPlayer, setSelectedChartPlayer] = useState(null);
          // Fonction pour ouvrir le graphique
const openProgressionChart = (playerName) => {
  console.log("Opening chart for:", playerName); // Pour debug
  setSelectedChartPlayer(playerName);
  setShowProgressionChart(true);
};
          // Fonction pour obtenir le grade basketball selon le score
          const getBadge = (score) => {
            // Grade Ultime
            if (score >= 250) return { 
              emoji: 'ğŸ', 
              name: 'GOAT', 
              fullName: 'Greatest Of All Time',
              color: 'text-purple-300',
              bgColor: 'from-purple-600 to-purple-800',
              description: 'Le plus grand de tous les temps'
            };
            
            // Grades Elite
            if (score >= 200) return { 
              emoji: 'ğŸ›ï¸', 
              name: 'Hall of Fame', 
              fullName: 'Hall of Fame',
              color: 'text-yellow-300',
              bgColor: 'from-yellow-500 to-yellow-700',
              description: 'LÃ©gende du sport'
            };
            if (score >= 150) return { 
              emoji: 'ğŸ”¥', 
              name: 'Superstar', 
              fullName: 'Superstar',
              color: 'text-orange-300',
              bgColor: 'from-orange-500 to-red-600',
              description: 'PhÃ©nomÃ¨ne basketball'
            };
            
            // Grades ConfirmÃ©s
            if (score >= 100) return { 
              emoji: 'ğŸŒŸ', 
              name: 'All-Star', 
              fullName: 'All-Star',
              color: 'text-blue-300',
              bgColor: 'from-blue-500 to-blue-700',
              description: 'SÃ©lectionnÃ© parmi l\'Ã©lite'
            };
            if (score >= 75) return { 
              emoji: 'ğŸ’', 
              name: 'Franchise Player', 
              fullName: 'Franchise Player',
              color: 'text-cyan-300',
              bgColor: 'from-cyan-500 to-blue-600',
              description: 'Pilier de l\'Ã©quipe'
            };
            
            // Grades DÃ©veloppement
            if (score >= 50) return { 
              emoji: 'â­', 
              name: 'Starting Five', 
              fullName: 'Starting Five',
              color: 'text-green-300',
              bgColor: 'from-green-500 to-green-700',
              description: 'Titulaire indiscutable'
            };
            if (score >= 25) return { 
              emoji: 'ğŸƒ', 
              name: 'Sixth Man', 
              fullName: 'Sixth Man',
              color: 'text-emerald-300',
              bgColor: 'from-emerald-500 to-green-600',
              description: 'Premier remplaÃ§ant de qualitÃ©'
            };
            
            // Grades DÃ©butants
            if (score >= 10) return { 
              emoji: 'ğŸ€', 
              name: 'Rookie', 
              fullName: 'Rookie',
              color: 'text-amber-300',
              bgColor: 'from-amber-500 to-orange-500',
              description: 'DÃ©butant prometteur'
            };
            if (score >= 0) return { 
              emoji: 'ğŸ‘¶', 
              name: 'Freshman', 
              fullName: 'Freshman',
              color: 'text-yellow-300',
              bgColor: 'from-yellow-400 to-amber-500',
              description: 'PremiÃ¨re annÃ©e, apprend les bases'
            };
            
            // Grades NÃ©gatifs
            if (score >= -25) return { 
              emoji: 'ğŸ“‰', 
              name: 'Plot', 
              fullName: 'Plot',
              color: 'text-gray-400',
              bgColor: 'from-gray-500 to-gray-700',
              description: 'Personnage sans importance'
            };
            if (score >= -50) return { 
              emoji: 'ğŸª‘', 
              name: 'Benchwarmer', 
              fullName: 'Benchwarmer',
              color: 'text-red-400',
              bgColor: 'from-red-500 to-red-700',
              description: 'ClouÃ© sur le banc'
            };
            
            // Pire niveau
            return { 
              emoji: 'ğŸ—‘ï¸', 
              name: 'Scrub', 
              fullName: 'Scrub',
              color: 'text-red-600',
              bgColor: 'from-red-700 to-red-900',
              description: 'Le pire niveau possible'
            };
          };

          // Fonction pour obtenir l'avatar animÃ© de la franchise
          const getFranchiseAvatar = (franchise) => {
            const avatars = {
              Minotaurs: { emoji: 'ğŸ‚', class: 'minotaur-avatar', name: 'Taureau EnragÃ©' },
              Krakens: { emoji: 'ğŸ™', class: 'kraken-avatar', name: 'Kraken des Profondeurs' },
              Phoenix: { emoji: 'ğŸ”¥', class: 'phoenix-avatar', name: 'Phoenix Ã‰ternel' },
              Werewolves: { emoji: 'ğŸº', class: 'werewolf-avatar', name: 'Loup-Garou' }
            };
            return avatars[franchise] || { emoji: 'âš¡', class: 'franchise-avatar', name: 'Guerrier' };
          };

          // Actions positives et nÃ©gatives
          const positiveActions = [
            { label: 'Hardworker', points: 6 },
            { label: 'Victoire le weekend', points: 4 },
            { label: 'Participation le weekend', points: 2 },
            { label: 'Entrainement/atelier facultatif', points: 4 },
            { label: 'Observation positive', points: 5 },
            { label: 'Bonus', points: 2 },
            { label: 'Bonus', points: 3 },
            { label: 'Bonus', points: 5 },
            { label: 'Bonus', points: 10 },
            { label: 'FÃ©licitations', points: 25 },
            { label: 'Compliments', points: 15 },
            { label: 'Encouragements', points: 10 }
          ];

          const negativeActions = [
            { label: 'Observation nÃ©gative', points: -5 },
            { label: 'Exclusion de cours', points: -8 },
            { label: 'Exclusion temporaire de l\'Ã©tablissement', points: -15 },
            { label: 'Travail non fait', points: -3 },
            { label: 'Retard/absence non justifiÃ©e', points: -3 },
            { label: 'Absence non justifiÃ©e au club', points: -3 },
            { label: 'PÃ©nalitÃ©', points: -2 },
            { label: 'PÃ©nalitÃ©', points: -3 },
            { label: 'PÃ©nalitÃ©', points: -5 }
          ];

          // Couleurs des franchises
          const franchiseColors = {
            Minotaurs: 'from-red-600 to-red-800',
            Krakens: 'from-blue-600 to-blue-800',
            Phoenix: 'from-orange-600 to-orange-800',
            Werewolves: 'from-green-600 to-green-800'
          };

          // VÃ©rifier le mot de passe professeur
          const verifyTeacher = async () => {
            if (!password.trim()) {
              setLoginError('Veuillez entrer un mot de passe');
              return;
            }
            
            try {
              const response = await fetch('/api/verify-teacher', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ password })
              });
              
              const data = await response.json();
              if (data.success) {
                setUserType('teacher');
                setCurrentView('teacher-dashboard');
                setLoginError('');
              } else {
                setLoginError('Mot de passe incorrect');
              }
            } catch (error) {
              setLoginError('Erreur de connexion');
            }
          };

          // Charger les joueurs
          const loadPlayers = async () => {
            try {
              const response = await fetch('/api/players');
              const data = await response.json();
              setPlayers(data);
            } catch (error) {
              console.error('Erreur lors du chargement des joueurs:', error);
            }
          };

          // Ajouter des points (professeurs uniquement)
          const addPoints = async (playerName, points, action) => {
            setLoading(true);
            try {
              const response = await fetch('/api/add-points', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ playerName, points, action, teacherName })
              });
              
              if (response.ok) {
                await loadPlayers();
                setExpandedDropdown(null);
              }
            } catch (error) {
              console.error('Erreur lors de l\'ajout de points:', error);
            }
            setLoading(false);
          };

          // Charger l'historique d'un joueur
          const loadPlayerHistory = async (playerName) => {
            try {
              const response = await fetch(`/api/history/${encodeURIComponent(playerName)}`);
              const data = await response.json();
              setPlayerHistory(data);
              setSelectedPlayerHistory(playerName);
            } catch (error) {
              console.error('Erreur lors du chargement de l\'historique:', error);
            }
          };

          // Annuler la derniÃ¨re action (professeurs uniquement)
          const undoLastAction = async (playerName) => {
            setLoading(true);
            try {
              const response = await fetch(`/api/undo-last/${encodeURIComponent(playerName)}`, {
                method: 'DELETE',
              });
              
              if (response.ok) {
                await loadPlayers();
              }
            } catch (error) {
              console.error('Erreur lors de l\'annulation:', error);
            }
            setLoading(false);
          };

          // Ajouter un Ã©lÃ¨ve (professeurs uniquement)
          const addStudent = async () => {
            if (!newStudentName.trim()) {
              alert('Veuillez entrer un nom');
              return;
            }
            
            try {
              const response = await fetch('/api/add-student', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ 
                  name: newStudentName.trim(), 
                  franchise: newStudentFranchise 
                })
              });
              
              if (response.ok) {
                setNewStudentName('');
                await loadPlayers();
                alert('Ã‰lÃ¨ve ajoutÃ© avec succÃ¨s !');
              } else {
                const error = await response.json();
                alert(error.error || 'Erreur lors de l\'ajout');
              }
            } catch (error) {
              alert('Erreur lors de l\'ajout de l\'Ã©lÃ¨ve');
            }
          };

          // Supprimer un Ã©lÃ¨ve (professeurs uniquement)
          const removeStudent = async (playerName) => {
            if (!confirm(`ÃŠtes-vous sÃ»r de vouloir supprimer ${playerName} ? Cette action est irrÃ©versible.`)) {
              return;
            }
            
            try {
              const response = await fetch(`/api/remove-student/${encodeURIComponent(playerName)}`, {
                method: 'DELETE'
              });
              
              if (response.ok) {
                await loadPlayers();
                alert('Ã‰lÃ¨ve supprimÃ© avec succÃ¨s');
              }
            } catch (error) {
              alert('Erreur lors de la suppression');
            }
          };

          useEffect(() => {
            if (userType) {
              loadPlayers();
              const interval = setInterval(loadPlayers, 10000);
              return () => clearInterval(interval);
            }
          }, [userType]);

          // Obtenir les joueurs triÃ©s par score pour une franchise
          const getSortedPlayers = (franchise) => {
            return players
              .filter(player => player.franchise === franchise)
              .sort((a, b) => b.score - a.score);
          };

          // Obtenir le classement des franchises
          const getFranchiseRankings = () => {
            const franchiseScores = {};
            ['Minotaurs', 'Krakens', 'Phoenix', 'Werewolves'].forEach(franchise => {
              franchiseScores[franchise] = players
                .filter(player => player.franchise === franchise)
                .reduce((total, player) => total + player.score, 0);
            });
            
            return Object.entries(franchiseScores)
              .sort(([,a], [,b]) => b - a)
              .map(([franchise, score], index) => ({ franchise, score, rank: index + 1 }));
          };

          // Obtenir le classement gÃ©nÃ©ral des joueurs
          const getGeneralPlayerRankings = () => {
            return [...players].sort((a, b) => b.score - a.score);
          };
// Fonction pour filtrer l'historique selon la pÃ©riode sÃ©lectionnÃ©e
const filterHistoryByPeriod = (history, period) => {
  if (!history || history.length === 0) return [];
  
  const now = new Date();
  let startDate;
  
  switch(period) {
    case '15days':
      startDate = new Date(now);
      startDate.setDate(startDate.getDate() - 15);
      break;
    case '3months':
      startDate = new Date(now);
      startDate.setMonth(startDate.getMonth() - 3);
      break;
    case 'all':
      return history; // Retourner tout l'historique
    default:
      return history;
  }
  
  // Filtrer les entrÃ©es aprÃ¨s la date de dÃ©but
  return history.filter(entry => {
    // Convertir le format franÃ§ais en format Date
    const parts = entry.timestamp.split(/[\s,:/]+/);
    const entryDate = new Date(
      parseInt(parts[2]), // annÃ©e
      parseInt(parts[1]) - 1, // mois (0-indexÃ©)
      parseInt(parts[0]), // jour
      parseInt(parts[3] || 0), // heures
      parseInt(parts[4] || 0) // minutes
    );
    return entryDate >= startDate;
  });
};
            
  if (!history || history.length === 0) return [];
  
  const now = new Date();
  let startDate;
  
  switch(period) {
    case '15days':
      startDate = new Date(now);
      startDate.setDate(startDate.getDate() - 15);
      break;
    case '3months':
      startDate = new Date(now);
      startDate.setMonth(startDate.getMonth() - 3);
      break;
    case 'all':
      return history; // Retourner tout l'historique
    default:
      return history;
  }
  
  // Filtrer les entrÃ©es aprÃ¨s la date de dÃ©but
  return history.filter(entry => {
    // Convertir le format franÃ§ais en format Date
    const parts = entry.timestamp.split(/[\s,:/]+/);
    const entryDate = new Date(
      parseInt(parts[2]), // annÃ©e
      parseInt(parts[1]) - 1, // mois (0-indexÃ©)
      parseInt(parts[0]), // jour
      parseInt(parts[3] || 0), // heures
      parseInt(parts[4] || 0) // minutes
    );
    return entryDate >= startDate;
  });
};
        // Composant pour le graphique de progression
const ProgressChart = ({ history, period }) => {
  const canvasRef = React.useRef(null);
  const chartRef = React.useRef(null);
  
  React.useEffect(() => {
    if (!history || history.length === 0) return;
    
    // DÃ©truire le graphique existant si prÃ©sent
    if (chartRef.current) {
      chartRef.current.destroy();
    }
    
    // PrÃ©parer les donnÃ©es pour le graphique
    const reversedHistory = [...history].reverse();
    const labels = [];
    const scores = [];
    let runningScore = 0;
    
    // Calculer le score cumulÃ© pour chaque point
    reversedHistory.forEach(entry => {
      runningScore += entry.points;
      
      // Formater la date pour l'affichage
      const dateParts = entry.timestamp.split(' ');
      labels.push(dateParts[0]); // Juste la date (jour/mois/annÃ©e)
      scores.push(runningScore);
    });
    
    // CrÃ©er le graphique
    const ctx = canvasRef.current.getContext('2d');
    chartRef.current = new Chart(ctx, {
      type: 'line',
      data: {
        labels: labels,
        datasets: [{
          label: 'Score',
          data: scores,
          borderColor: 'rgb(147, 51, 234)', // Violet
          backgroundColor: 'rgba(147, 51, 234, 0.1)',
          tension: 0.1,
          borderWidth: 2,
          pointRadius: 4,
          pointBackgroundColor: 'rgb(147, 51, 234)',
          pointBorderColor: '#fff',
          pointBorderWidth: 2
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            display: false
          },
          tooltip: {
            backgroundColor: 'rgba(0, 0, 0, 0.8)',
            padding: 12,
            titleColor: '#fff',
            bodyColor: '#fff',
            borderColor: 'rgb(147, 51, 234)',
            borderWidth: 1,
            displayColors: false,
            callbacks: {
              label: function(context) {
                return 'Score: ' + context.parsed.y + ' points';
              }
            }
          }
        },
        scales: {
          x: {
            grid: {
              color: 'rgba(255, 255, 255, 0.1)'
            },
            ticks: {
              color: 'rgba(255, 255, 255, 0.7)',
              maxRotation: 45,
              minRotation: 45
            }
          },
          y: {
            grid: {
              color: 'rgba(255, 255, 255, 0.1)'
            },
            ticks: {
              color: 'rgba(255, 255, 255, 0.7)',
              stepSize: 10
            },
            beginAtZero: false
          }
        }
      }
    });
    
    // Cleanup
    return () => {
      if (chartRef.current) {
        chartRef.current.destroy();
      }
    };
  }, [history, period]);
  
  return (
    <div style={{ height: '300px', position: 'relative' }}>
      <canvas ref={canvasRef}></canvas>
    </div>
  );

          // PAGE D'ACCUEIL - CHOIX DU TYPE D'UTILISATEUR
          if (currentView === 'home') 
             return (
              <div className="min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 p-8">
                <div className="max-w-4xl mx-auto">
                  <h1 className="text-6xl font-bold text-center text-white mb-4">
                    ğŸ† SystÃ¨me de Gestion Scolaire ğŸ†
                  </h1>
                  <p className="text-xl text-center text-purple-200 mb-12">
                    Choisissez votre type d'accÃ¨s
                  </p>
                  
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <button
                      onClick={() => setCurrentView('teacher-login')}
                      className="group relative overflow-hidden bg-gradient-to-r from-emerald-600 to-emerald-800 hover:from-emerald-500 hover:to-emerald-700 text-white p-8 rounded-xl shadow-2xl transform hover:scale-105 transition-all duration-300"
                    >
                      <div className="absolute inset-0 bg-white opacity-0 group-hover:opacity-10 transition-opacity duration-300"></div>
                      <div className="relative z-10 flex flex-col items-center">
                        <div className="text-6xl mb-4">ğŸ‘¨â€ğŸ«</div>
                        <h2 className="text-3xl font-bold mb-2">PROFESSEUR</h2>
                        <p className="text-emerald-100">Gestion complÃ¨te</p>
                        <p className="text-sm text-emerald-200 mt-2">ğŸ” Mot de passe requis</p>
                      </div>
                    </button>
                    
                    <button
                      onClick={() => {
                        setUserType('student');
                        setCurrentView('student-dashboard');
                      }}
                      className="group relative overflow-hidden bg-gradient-to-r from-amber-600 to-amber-800 hover:from-amber-500 hover:to-amber-700 text-white p-8 rounded-xl shadow-2xl transform hover:scale-105 transition-all duration-300"
                    >
                      <div className="absolute inset-0 bg-white opacity-0 group-hover:opacity-10 transition-opacity duration-300"></div>
                      <div className="relative z-10 flex flex-col items-center">
                        <div className="text-6xl mb-4">ğŸ‘¨â€ğŸ“</div>
                        <h2 className="text-3xl font-bold mb-2">Ã‰LÃˆVE</h2>
                        <p className="text-amber-100">Consultation des scores</p>
                        <p className="text-sm text-amber-200 mt-2">ğŸ‘ï¸ Lecture seule</p>
                      </div>
                    </button>
                  </div>
                </div>
              </div>
            );
          }

          // PAGE DE CONNEXION PROFESSEUR
          if (currentView === 'teacher-login') {
            return (
              <div className="min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 p-8 flex items-center justify-center">
                <div className="bg-white/10 backdrop-blur-sm rounded-xl p-8 max-w-md w-full">
                  <h2 className="text-3xl font-bold text-white text-center mb-8">
                    ğŸ” Connexion Professeur
                  </h2>
                  
                  <div className="space-y-6">
                    <div>
                      <label className="block text-white text-sm font-bold mb-2">
                        Nom (optionnel)
                      </label>
                      <input
                        type="text"
                        value={teacherName}
                        onChange={(e) => setTeacherName(e.target.value)}
                        className="w-full px-3 py-2 rounded-lg bg-white/20 text-white placeholder-white/70 border border-white/30 focus:border-white/70 focus:outline-none"
                        placeholder="Votre nom..."
                      />
                    </div>
                    
                    <div>
                      <label className="block text-white text-sm font-bold mb-2">
                        Mot de passe *
                      </label>
                      <input
                        type="password"
                        value={password}
                        onChange={(e) => setPassword(e.target.value)}
                        onKeyPress={(e) => e.key === 'Enter' && verifyTeacher()}
                        className="w-full px-3 py-2 rounded-lg bg-white/20 text-white placeholder-white/70 border border-white/30 focus:border-white/70 focus:outline-none"
                        placeholder="Mot de passe..."
                      />
                    </div>
                    
                    {loginError && (
                      <div className="text-red-300 text-sm text-center">
                        {loginError}
                      </div>
                    )}
                    
                    <div className="flex space-x-4">
                      <button
                        onClick={() => setCurrentView('home')}
                        className="flex-1 bg-gray-600 hover:bg-gray-500 text-white py-3 rounded-lg transition-colors"
                      >
                        â† Retour
                      </button>
                      <button
                        onClick={verifyTeacher}
                        className="flex-1 bg-emerald-600 hover:bg-emerald-500 text-white py-3 rounded-lg transition-colors"
                      >
                        Se connecter
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            );
          }

          // TABLEAU DE BORD PROFESSEUR
          if (currentView === 'teacher-dashboard') {
            return (
              <div className="min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 p-8">
                <div className="max-w-6xl mx-auto">
                  <div className="flex justify-between items-center mb-8">
                    <h1 className="text-4xl font-bold text-white">
                      ğŸ‘¨â€ğŸ« Tableau de Bord Professeur
                      {teacherName && <span className="text-2xl text-purple-200"> - {teacherName}</span>}
                    </h1>
                    <button
                      onClick={() => {
                        setCurrentView('home');
                        setUserType(null);
                        setPassword('');
                        setTeacherName('');
                      }}
                      className="bg-red-600 hover:bg-red-500 text-white px-6 py-3 rounded-lg transition-colors"
                    >
                      ğŸšª DÃ©connexion
                    </button>
                  </div>

                  <div className="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                    <button
                      onClick={() => setCurrentView('teacher-players')}
                      className="bg-gradient-to-r from-emerald-600 to-emerald-800 hover:from-emerald-500 hover:to-emerald-700 text-white p-6 rounded-xl shadow-2xl transform hover:scale-105 transition-all duration-300"
                    >
                      <div className="text-4xl mb-2">ğŸ‘¥</div>
                      <h3 className="text-xl font-bold">Gestion des Points</h3>
                      <p className="text-emerald-100 text-sm">Ajouter/retirer des points</p>
                    </button>
                    
                    <button
                      onClick={() => setCurrentView('teacher-admin')}
                      className="bg-gradient-to-r from-blue-600 to-blue-800 hover:from-blue-500 hover:to-blue-700 text-white p-6 rounded-xl shadow-2xl transform hover:scale-105 transition-all duration-300"
                    >
                      <div className="text-4xl mb-2">âš™ï¸</div>
                      <h3 className="text-xl font-bold">Administration</h3>
                      <p className="text-blue-100 text-sm">GÃ©rer les Ã©lÃ¨ves</p>
                    </button>
                    
                    <button
                      onClick={() => setCurrentView('rankings')}
                      className="bg-gradient-to-r from-amber-600 to-amber-800 hover:from-amber-500 hover:to-amber-700 text-white p-6 rounded-xl shadow-2xl transform hover:scale-105 transition-all duration-300"
                    >
                      <div className="text-4xl mb-2">ğŸ†</div>
                      <h3 className="text-xl font-bold">Classements</h3>
                      <p className="text-amber-100 text-sm">Voir les rÃ©sultats</p>
                    </button>
                    
                    <button
                      onClick={() => setCurrentView('badges')}
                      className="bg-gradient-to-r from-purple-600 to-purple-800 hover:from-purple-500 hover:to-purple-700 text-white p-6 rounded-xl shadow-2xl transform hover:scale-105 transition-all duration-300"
                    >
                      <div className="text-4xl mb-2">ğŸ…</div>
                      <h3 className="text-xl font-bold">Badges</h3>
                      <p className="text-purple-100 text-sm">Voir tous les badges</p>
                    </button>
                  </div>

                  <div className="bg-white/10 backdrop-blur-sm rounded-xl p-6">
                    <h3 className="text-2xl font-bold text-white mb-4">ğŸ“Š Statistiques Rapides</h3>
                    <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                      {['Minotaurs', 'Krakens', 'Phoenix', 'Werewolves'].map(franchise => {
                        const franchisePlayers = getSortedPlayers(franchise);
                        const totalPoints = franchisePlayers.reduce((sum, player) => sum + player.score, 0);
                        const avatar = getFranchiseAvatar(franchise);
                        return (
                          <div key={franchise} className={`bg-gradient-to-r ${franchiseColors[franchise]} p-4 rounded-lg text-center franchise-card`}>
                            <div className="flex items-center justify-center mb-2">
                              <span className={`franchise-avatar ${avatar.class}`}>
                                {avatar.emoji}
                              </span>
                            </div>
                            <h4 className="font-bold text-white">{franchise}</h4>
                            <div className="text-2xl font-bold text-white">{totalPoints}</div>
                            <div className="text-sm text-white/80">{franchisePlayers.length} Ã©lÃ¨ves</div>
                          </div>
                        );
                      })}
                    </div>
                  </div>
                </div>
              </div>
            );
          }

          // GESTION DES POINTS PROFESSEUR
          if (currentView === 'teacher-players') {
            return (
              <div className="min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 p-8">
                <div className="max-w-7xl mx-auto">
                  <div className="flex justify-between items-center mb-8">
                    <h1 className="text-4xl font-bold text-white">ğŸ‘¥ Gestion des Points</h1>
                    <div className="flex space-x-4">
                      {loading && <div className="text-white">â³ Chargement...</div>}
                      <button
                        onClick={() => setCurrentView('teacher-dashboard')}
                        className="bg-gray-600 hover:bg-gray-500 text-white px-6 py-3 rounded-lg transition-colors"
                      >
                        â† Retour Tableau de Bord
                      </button>
                    </div>
                  </div>

                  <div className="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-4 gap-6">
                    {['Minotaurs', 'Krakens', 'Phoenix', 'Werewolves'].map(franchise => {
                      const avatar = getFranchiseAvatar(franchise);
                      return (
                        <div key={franchise} className="bg-white/10 backdrop-blur-sm rounded-xl p-6 franchise-card">
                          <h2 className={`text-2xl font-bold text-white mb-4 text-center bg-gradient-to-r ${franchiseColors[franchise]} p-3 rounded-lg flex items-center justify-center space-x-2`}>
                            <span className={`franchise-avatar ${avatar.class}`}>
                              {avatar.emoji}
                            </span>
                            <span>{franchise}</span>
                          </h2>
                          <div className="space-y-3">
                            {getSortedPlayers(franchise).map(player => (
                              <div key={player.name} className="bg-white/20 rounded-lg p-3">
                                <div className="flex justify-between items-center mb-2">
  <div className="flex items-center space-x-2">
    <button
      onClick={() => loadPlayerHistory(player.name)}
      className="text-white font-semibold hover:text-yellow-300 transition-colors flex items-center space-x-1"
      title="Voir l'historique"
    >
      <span>{player.name}</span>
      <span>ğŸ“‹</span>
    </button>
    <button
      onClick={() => openProgressionChart(player.name)}
      className="text-white hover:text-blue-300 transition-colors"
      title="Voir le graphique de progression"
    >
      ğŸ“ˆ
    </button>
  </div>
  <div className="flex items-center space-x-2">
    <div className="flex items-center space-x-1">
      <span className={`text-2xl ${getBadge(player.score).emoji}`}>
        {getBadge(player.score).emoji}
      </span>
      <span className="text-white font-bold">
        {player.score} pts
      </span>
    </div>
    <button
      onClick={() => undoLastAction(player.name)}
      className="bg-red-500 hover:bg-red-400 text-white px-2 py-1 rounded text-xs"
      title="Annuler derniÃ¨re action"
    >
      â†º
    </button>
  </div>
</div>
                                {/* Affichage des badges */}
                                  {console.log('Player:', player.name, 'Badges:', player.badges)}
                                <BadgeDisplay badges={player.badges || []} />
                                <div className="relative">
                                  <button
                                    onClick={() => setExpandedDropdown(expandedDropdown === player.name ? null : player.name)}
                                    className="w-full bg-blue-600 hover:bg-blue-500 text-white px-3 py-2 rounded flex justify-between items-center transition-colors"
                                    disabled={loading}
                                  >
                                    <span>Actions</span>
                                    <span>{expandedDropdown === player.name ? 'âŒƒ' : 'âŒ„'}</span>
                                  </button>
                                  
                                  {expandedDropdown === player.name && (
                                    <div className="absolute top-full left-0 right-0 bg-white rounded-lg shadow-xl z-10 mt-1 max-h-64 overflow-y-auto">
                                      <div className="p-2">
                                        <div className="text-green-700 font-semibold mb-2">Points positifs:</div>
                                        {positiveActions.map((action, index) => (
                                          <button
                                            key={`pos-${index}`}
                                            onClick={() => addPoints(player.name, action.points, action.label)}
                                            className="w-full text-left px-3 py-2 hover:bg-green-100 rounded text-sm flex justify-between"
                                            disabled={loading}
                                          >
                                            <span>{action.label}</span>
                                            <span className="text-green-600 font-bold">+{action.points}</span>
                                          </button>
                                        ))}
                                        
                                        <div className="text-red-700 font-semibold mb-2 mt-3">Points nÃ©gatifs:</div>
                                        {negativeActions.map((action, index) => (
                                          <button
                                            key={`neg-${index}`}
                                            onClick={() => addPoints(player.name, action.points, action.label)}
                                            className="w-full text-left px-3 py-2 hover:bg-red-100 rounded text-sm flex justify-between"
                                            disabled={loading}
                                          >
                                            <span>{action.label}</span>
                                            <span className="text-red-600 font-bold">{action.points}</span>
                                          </button>
                                        ))}
                                      </div>
                                    </div>
                                  )}
                                </div>
                              </div>
                            ))}
                          </div>
                        </div>
                      );
                    })}
                  </div>
                </div>
              </div>
            );
          }

          // ADMINISTRATION PROFESSEUR
          if (currentView === 'teacher-admin') {
            return (
              <div className="min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 p-8">
                <div className="max-w-6xl mx-auto">
                  <div className="flex justify-between items-center mb-8">
                    <h1 className="text-4xl font-bold text-white">âš™ï¸ Administration des Ã‰lÃ¨ves</h1>
                    <button
                      onClick={() => setCurrentView('teacher-dashboard')}
                      className="bg-gray-600 hover:bg-gray-500 text-white px-6 py-3 rounded-lg transition-colors"
                    >
                      â† Retour Tableau de Bord
                    </button>
                  </div>

                  <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div className="bg-white/10 backdrop-blur-sm rounded-xl p-6">
                      <h2 className="text-2xl font-bold text-white mb-6 text-center">
                        â• Ajouter un Ã‰lÃ¨ve
                      </h2>
                      <div className="space-y-4">
                        <div>
                          <label className="block text-white text-sm font-bold mb-2">
                            Nom de l'Ã©lÃ¨ve
                          </label>
                          <input
                            type="text"
                            value={newStudentName}
                            onChange={(e) => setNewStudentName(e.target.value)}
                            className="w-full px-3 py-2 rounded-lg bg-white/20 text-white placeholder-white/70 border border-white/30 focus:border-white/70 focus:outline-none"
                            placeholder="PrÃ©nom Nom..."
                          />
                        </div>
                        
                        <div>
                          <label className="block text-white text-sm font-bold mb-2">
                            Franchise
                          </label>
                          <select
                            value={newStudentFranchise}
                            onChange={(e) => setNewStudentFranchise(e.target.value)}
                            className="w-full px-3 py-2 rounded-lg bg-white/20 text-white border border-white/30 focus:border-white/70 focus:outline-none"
                          >
                            <option value="Minotaurs" className="text-black">Minotaurs</option>
                            <option value="Krakens" className="text-black">Krakens</option>
                            <option value="Phoenix" className="text-black">Phoenix</option>
                            <option value="Werewolves" className="text-black">Werewolves</option>
                          </select>
                        </div>
                        
                        <button
                          onClick={addStudent}
                          className="w-full bg-green-600 hover:bg-green-500 text-white py-3 rounded-lg transition-colors font-bold"
                        >
                          â• Ajouter l'Ã‰lÃ¨ve
                        </button>
                      </div>
                    </div>

                    <div className="bg-white/10 backdrop-blur-sm rounded-xl p-6">
                      <h2 className="text-2xl font-bold text-white mb-6 text-center">
                        ğŸ—‘ï¸ Supprimer un Ã‰lÃ¨ve
                      </h2>
                      <div className="space-y-4">
                        <div>
                          <label className="block text-white text-sm font-bold mb-2">
                            SÃ©lectionner un Ã©lÃ¨ve
                          </label>
                          <select
                            value={selectedStudent}
                            onChange={(e) => setSelectedStudent(e.target.value)}
                            className="w-full px-3 py-2 rounded-lg bg-white/20 text-white border border-white/30 focus:border-white/70 focus:outline-none"
                          >
                            <option value="" className="text-black">-- Choisir un Ã©lÃ¨ve --</option>
                            {players
                              .sort((a, b) => a.name.localeCompare(b.name))
                              .map(player => (
                                <option key={player.name} value={player.name} className="text-black">
                                  {player.name} ({player.franchise})
                                </option>
                              ))}
                          </select>
                        </div>
                        
                        <button
                          onClick={() => selectedStudent && removeStudent(selectedStudent)}
                          disabled={!selectedStudent}
                          className="w-full bg-red-600 hover:bg-red-500 disabled:bg-gray-500 disabled:cursor-not-allowed text-white py-3 rounded-lg transition-colors font-bold"
                        >
                          ğŸ—‘ï¸ Supprimer l'Ã‰lÃ¨ve
                        </button>
                        
                        <p className="text-red-300 text-sm text-center">
                          âš ï¸ Cette action est irrÃ©versible !
                        </p>
                      </div>
                    </div>
                  </div>

                  <div className="mt-8 bg-white/10 backdrop-blur-sm rounded-xl p-6">
                    <h2 className="text-2xl font-bold text-white mb-6 text-center">
                      ğŸ“‹ Liste Actuelle des Ã‰lÃ¨ves
                    </h2>
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                      {['Minotaurs', 'Krakens', 'Phoenix', 'Werewolves'].map(franchise => {
                        const avatar = getFranchiseAvatar(franchise);
                        return (
                          <div key={franchise} className={`bg-gradient-to-r ${franchiseColors[franchise]} p-4 rounded-lg franchise-card`}>
                            <div className="flex items-center justify-center mb-3">
                              <span className={`franchise-avatar ${avatar.class}`}>
                                {avatar.emoji}
                              </span>
                              <h3 className="text-xl font-bold text-white ml-2">{franchise}</h3>
                            </div>
                            <div className="space-y-2">
                              {getSortedPlayers(franchise).map(player => (
                                <div key={player.name} className="bg-white/20 p-2 rounded text-white text-sm">
                                  <div className="flex justify-between items-center">
                                    <span>{player.name}</span>
                                    <span className="font-bold">{player.score} pts</span>
                                  </div>
                                </div>
                              ))}
                            </div>
                            <div className="text-center mt-3 text-white/80 text-sm">
                              {getSortedPlayers(franchise).length} Ã©lÃ¨ve(s)
                            </div>
                          </div>
                        );
                      })}
                    </div>
                  </div>
                </div>
              </div>
            );
          }

          // TABLEAU DE BORD Ã‰LÃˆVE
          if (currentView === 'student-dashboard') {
            return (
              <div className="min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 p-8">
                <div className="max-w-4xl mx-auto">
                  <div className="flex justify-between items-center mb-8">
                    <h1 className="text-4xl font-bold text-white">ğŸ‘¨â€ğŸ“ Espace Ã‰lÃ¨ve</h1>
                    <button
                      onClick={() => {
                        setCurrentView('home');
                        setUserType(null);
                      }}
                      className="bg-gray-600 hover:bg-gray-500 text-white px-6 py-3 rounded-lg transition-colors"
                    >
                      â† Retour Accueil
                    </button>
                  </div>

                  <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <button
                      onClick={() => setCurrentView('student-search')}
                      className="bg-gradient-to-r from-blue-600 to-blue-800 hover:from-blue-500 hover:to-blue-700 text-white p-6 rounded-xl shadow-2xl transform hover:scale-105 transition-all duration-300"
                    >
                      <div className="text-4xl mb-2">ğŸ”</div>
                      <h3 className="text-xl font-bold">Mon Score</h3>
                      <p className="text-blue-100 text-sm">Voir mon historique personnel</p>
                    </button>

                    <button
                      onClick={() => setCurrentView('badges')}
                      className="bg-gradient-to-r from-purple-600 to-purple-800 hover:from-purple-500 hover:to-purple-700 text-white p-6 rounded-xl shadow-2xl transform hover:scale-105 transition-all duration-300"
                    >
                      <div className="text-4xl mb-2">ğŸ…</div>
                      <h3 className="text-xl font-bold">Badges</h3>
                      <p className="text-purple-100 text-sm">DÃ©couvrir les badges</p>
                    </button>

                      <button
  onClick={() => setCurrentView('grades')}
  className="bg-gradient-to-r from-orange-600 to-orange-800 hover:from-orange-500 hover:to-orange-700 text-white p-6 rounded-xl shadow-2xl transform hover:scale-105 transition-all duration-300"
>
  <div className="text-4xl mb-2">ğŸ€</div>
  <h3 className="text-xl font-bold">Grades</h3>
  <p className="text-orange-100 text-sm">DÃ©couvrir les grades</p>
</button>
                    
                    <button
                      onClick={() => setCurrentView('rankings')}
                      className="bg-gradient-to-r from-amber-600 to-amber-800 hover:from-amber-500 hover:to-amber-700 text-white p-6 rounded-xl shadow-2xl transform hover:scale-105 transition-all duration-300"
                    >
                      <div className="text-4xl mb-2">ğŸ†</div>
                      <h3 className="text-xl font-bold">Classements</h3>
                      <p className="text-amber-100 text-sm">Voir tous les classements</p>
                    </button>
                  </div>

                  <div className="bg-white/10 backdrop-blur-sm rounded-xl p-6">
                    <h3 className="text-2xl font-bold text-white mb-6 text-center">
                      ğŸ  Les Quatre Franchises
                    </h3>
                    <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                      {['Minotaurs', 'Krakens', 'Phoenix', 'Werewolves'].map(franchise => {
                        const franchisePlayers = getSortedPlayers(franchise);
                        const totalPoints = franchisePlayers.reduce((sum, player) => sum + player.score, 0);
                        const avatar = getFranchiseAvatar(franchise);
                        return (
                          <div key={franchise} className={`bg-gradient-to-r ${franchiseColors[franchise]} p-4 rounded-lg text-center franchise-card`}>
                            <div className="flex items-center justify-center mb-2">
                              <span className={`franchise-avatar ${avatar.class}`}>
                                {avatar.emoji}
                              </span>
                            </div>
                            <h4 className="font-bold text-white text-lg">{franchise}</h4>
                            <div className="text-2xl font-bold text-white">{totalPoints}</div>
                            <div className="text-sm text-white/80">{franchisePlayers.length} Ã©lÃ¨ves</div>
                          </div>
                        );
                      })}
                    </div>
                  </div>
                </div>
              </div>
            );
          }

          // RECHERCHE Ã‰LÃˆVE
          if (currentView === 'student-search') {
            
            const searchPlayer = async () => {
              if (!searchName.trim()) {
                alert('Veuillez entrer votre nom');
                return;
              }

              try {
                const response = await fetch(`/api/player/${encodeURIComponent(searchName.trim())}`);
                if (response.ok) {
                  const player = await response.json();
                  setFoundPlayer(player);
                  
                  const historyResponse = await fetch(`/api/history/${encodeURIComponent(searchName.trim())}`);
                  const history = await historyResponse.json();
                  setSearchHistory(history);
                } else {
                  setFoundPlayer(null);
                  setSearchHistory([]);
                  alert('Ã‰lÃ¨ve non trouvÃ©. VÃ©rifiez l\'orthographe de votre nom.');
                }
              } catch (error) {
                alert('Erreur lors de la recherche');
              }
            };

            return (
              <div className="min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 p-8">
                <div className="max-w-4xl mx-auto">
                  <div className="flex justify-between items-center mb-8">
                    <h1 className="text-4xl font-bold text-white">ğŸ” Rechercher Mon Score</h1>
                    <button
                      onClick={() => setCurrentView('student-dashboard')}
                      className="bg-gray-600 hover:bg-gray-500 text-white px-6 py-3 rounded-lg transition-colors"
                    >
                      â† Retour
                    </button>
                  </div>

                  <div className="bg-white/10 backdrop-blur-sm rounded-xl p-6 mb-8">
                    <h2 className="text-2xl font-bold text-white mb-6 text-center">
                      Entrez votre nom complet
                    </h2>
                    <div className="flex space-x-4">
                      <input
                        type="text"
                        value={searchName}
                        onChange={(e) => setSearchName(e.target.value)}
                        onKeyPress={(e) => e.key === 'Enter' && searchPlayer()}
                        className="flex-1 px-4 py-3 rounded-lg bg-white/20 text-white placeholder-white/70 border border-white/30 focus:border-white/70 focus:outline-none text-lg"
                        placeholder="Votre prÃ©nom et nom..."
                      />
                      <button
                        onClick={searchPlayer}
                        className="bg-blue-600 hover:bg-blue-500 text-white px-8 py-3 rounded-lg transition-colors font-bold"
                      >
                        ğŸ” Rechercher
                      </button>
                    </div>
                  </div>

                  {foundPlayer && (
                    <div className="space-y-6">
                      <div className={`bg-gradient-to-r ${franchiseColors[foundPlayer.franchise]} p-6 rounded-xl franchise-card`}>
                        <div className="text-center">
                          <h2 className="text-3xl font-bold text-white mb-2">{foundPlayer.name}</h2>
                          <div className="text-xl text-white/90 mb-4 flex items-center justify-center space-x-3">
                            <span>Franchise:</span>
                            <div className="flex items-center space-x-2">
                              <span className={`franchise-avatar ${getFranchiseAvatar(foundPlayer.franchise).class}`}>
                                {getFranchiseAvatar(foundPlayer.franchise).emoji}
                              </span>
                              <span className="font-bold">{foundPlayer.franchise}</span>
                            </div>
                          </div>
                          <div className="mb-4">
                            <div className="inline-flex items-center space-x-2 bg-black/30 px-4 py-2 rounded-full">
                              <span className="text-3xl">{getBadge(foundPlayer.score).emoji}</span>
                              <span className={`text-xl font-bold ${getBadge(foundPlayer.score).color}`}>
                                {getBadge(foundPlayer.score).name}
                              </span>
                            </div>
                          </div>
                          <div className="text-5xl font-bold text-white">{foundPlayer.score} points</div>
                        </div>
                      </div>
                        <button
  onClick={() => openProgressionChart(foundPlayer.name)}
  className="mt-4 bg-white/20 hover:bg-white/30 text-white px-6 py-3 rounded-lg transition-colors font-bold"
>
  ğŸ“ˆ Voir ma progression
</button>
{foundPlayer.badges && foundPlayer.badges.length > 0 && (
  <div className="mt-6 bg-white/10 backdrop-blur-sm rounded-xl p-6">
    <h4 className="text-2xl font-bold text-white mb-4 text-center">
      ğŸ… Mes Badges ({foundPlayer.badges.length})
    </h4>
    <div className="flex flex-wrap gap-3 justify-center">
      {foundPlayer.badges.map((badge, index) => (
        <div key={index} className="bg-black/30 px-4 py-3 rounded-lg flex items-center gap-2 hover:bg-black/50 transition-colors">
          <span className="text-3xl">{badge.badge_emoji}</span>
          <div>
            <div className="text-white font-bold">{badge.badge_name}</div>
            <div className="text-yellow-300 text-xs">+{badge.points || 0} pts</div>
          </div>
        </div>
      ))}
    </div>
  </div>
)}
                        {/* SECTION GRAPHIQUE DE PROGRESSION */}
<div className="bg-white/10 backdrop-blur-sm rounded-xl p-6">
  <h3 className="text-2xl font-bold text-white mb-4 text-center">
    ğŸ“ˆ Ma Progression
  </h3>
  
  {/* Boutons de sÃ©lection de pÃ©riode */}
  <div className="flex justify-center gap-2 mb-4">
    <button
      onClick={() => setGraphPeriod('15days')}
      className={`px-4 py-2 rounded-lg transition-colors ${
        graphPeriod === '15days' 
          ? 'bg-purple-600 text-white' 
          : 'bg-white/20 text-white/70 hover:bg-white/30'
      }`}
    >
      15 jours
    </button>
    <button
      onClick={() => setGraphPeriod('3months')}
      className={`px-4 py-2 rounded-lg transition-colors ${
        graphPeriod === '3months' 
          ? 'bg-purple-600 text-white' 
          : 'bg-white/20 text-white/70 hover:bg-white/30'
      }`}
    >
      3 mois
    </button>
    <button
      onClick={() => setGraphPeriod('all')}
      className={`px-4 py-2 rounded-lg transition-colors ${
        graphPeriod === 'all' 
          ? 'bg-purple-600 text-white' 
          : 'bg-white/20 text-white/70 hover:bg-white/30'
      }`}
    >
      Tout
    </button>
  </div>
  
  {/* Le graphique */}
  <ProgressChart 
    history={filterHistoryByPeriod(searchHistory, graphPeriod)} 
    period={graphPeriod} 
  />
</div>
                      <div className="bg-white/10 backdrop-blur-sm rounded-xl p-6">
                        <h3 className="text-2xl font-bold text-white mb-6 text-center">
                          ğŸ“‹ Mon Historique
                        </h3>
                        <div className="space-y-3 max-h-96 overflow-y-auto">
                          {searchHistory.length > 0 ? (
                            searchHistory.map((entry, index) => (
                              <div key={index} className="bg-white/20 p-4 rounded-lg">
                                <div className="flex justify-between items-start">
                                  <div>
                                    <div className="font-semibold text-white">{entry.action}</div>
                                    <div className="text-sm text-white/80">{entry.timestamp}</div>
                                    {entry.teacher_name && entry.teacher_name !== 'Anonyme' && (
                                      <div className="text-xs text-white/60">Par: {entry.teacher_name}</div>
                                    )}
                                  </div>
                                  <div className="text-right">
                                    <div className={`text-lg font-bold ${entry.points > 0 ? 'text-green-300' : 'text-red-300'}`}>
                                      {entry.points > 0 ? '+' : ''}{entry.points}
                                    </div>
                                    <div className="text-sm text-white/70">Total: {entry.new_total}</div>
                                  </div>
                                </div>
                              </div>
                            ))
                          ) : (
                            <p className="text-white/70 text-center">Aucun historique disponible</p>
                          )}
                        </div>
                      </div>
                    </div>
                  )}
                </div>
              </div>
            );
          }

          // PAGE CLASSEMENTS
          if (currentView === 'rankings') {
            const franchiseRankings = getFranchiseRankings();
            const playerRankings = getGeneralPlayerRankings();

            return (
              <div className="min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 p-8">
                <div className="max-w-6xl mx-auto">
                  <div className="flex justify-between items-center mb-8">
                    <h1 className="text-4xl font-bold text-white">ğŸ† Classements</h1>
                    <button
                      onClick={() => setCurrentView(userType === 'teacher' ? 'teacher-dashboard' : 'student-dashboard')}
                      className="bg-gray-600 hover:bg-gray-500 text-white px-6 py-3 rounded-lg transition-colors"
                    >
                      â† Retour
                    </button>
                  </div>

                  <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div className="bg-white/10 backdrop-blur-sm rounded-xl p-6">
                      <h2 className="text-2xl font-bold text-white mb-6 text-center">
                        ğŸ† Classement des Franchises
                      </h2>
                      <div className="space-y-4">
                        {franchiseRankings.map(({ franchise, score, rank }) => {
                          const avatar = getFranchiseAvatar(franchise);
                          return (
                            <div
                              key={franchise}
                              className={`bg-gradient-to-r ${franchiseColors[franchise]} p-4 rounded-lg flex justify-between items-center shadow-lg franchise-card`}
                            >
                              <div className="flex items-center space-x-3">
                                <span className="text-2xl font-bold text-white">#{rank}</span>
                                <span className={`franchise-avatar ${avatar.class}`}>
                                  {avatar.emoji}
                                </span>
                                <span className="text-xl font-semibold text-white">{franchise}</span>
                              </div>
                              <span className="text-2xl font-bold text-white">{score} pts</span>
                            </div>
                          );
                        })}
                      </div>
                    </div>

                    <div className="bg-white/10 backdrop-blur-sm rounded-xl p-6">
                      <h2 className="text-2xl font-bold text-white mb-6 text-center">
                        ğŸ‘‘ Classement GÃ©nÃ©ral
                      </h2>
                      <div className="space-y-2 max-h-96 overflow-y-auto">
                        {playerRankings.map((player, index) => {
                          const badge = getBadge(player.score);
                          return (
                            <div
                              key={player.name}
                              className={`bg-gradient-to-r ${franchiseColors[player.franchise]} p-3 rounded-lg flex justify-between items-center shadow-md`}
                            >
                              <div className="flex items-center space-x-3">
                                <span className="text-lg font-bold text-white">#{index + 1}</span>
                                <span className="text-2xl">{badge.emoji}</span>
                                <div>
                                  <span className="text-lg font-semibold text-white">{player.name}</span>
                                  <div className="text-sm text-white/80">{player.franchise}</div>
                                </div>
                              </div>
                              <span className="text-lg font-bold text-white">{player.score} pts</span>
                            </div>
                          );
                        })}
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            );
          }

          // PAGE DES BADGES
          if (currentView === 'badges') {
            return (
              <div className="min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 p-8">
                <div className="max-w-7xl mx-auto">
                  <div className="flex justify-between items-center mb-8">
                    <h1 className="text-4xl font-bold text-white">ğŸ… Collection de Badges</h1>
                    <button
                      onClick={() => setCurrentView(userType === 'teacher' ? 'teacher-dashboard' : 'student-dashboard')}
                      className="bg-gray-600 hover:bg-gray-500 text-white px-6 py-3 rounded-lg transition-colors"
                    >
                      â† Retour
                    </button>
                  </div>

                  {/* Badges Individuels */}
                  <div className="bg-white/10 backdrop-blur-sm rounded-xl p-6 mb-8">
                    <h2 className="text-2xl font-bold text-white mb-6 text-center">ğŸ‘¤ Badges Individuels</h2>
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
                      {Object.values(individualBadges).map(badge => {
                        // Compter combien de joueurs ont ce badge
                        const playersWithBadge = Object.entries(playerBadges).filter(([player, badges]) =>
                          badges?.some(b => b.id === badge.id)
                        ).map(([player]) => player);

                        return (
                          <div key={badge.id} className={`rounded-lg p-4 border-2 ${getRarityColor(badge.rarity)}`}>
                            <div className="flex items-center space-x-3 mb-3">
                              <span className="text-4xl">{badge.emoji}</span>
                              <div className="flex-1">
                                <h3 className="text-white font-bold text-lg">{badge.name}</h3>
                                <p className="text-white/70 text-sm">{badge.description}</p>
                                <p className="text-yellow-300 text-xs mt-1">+{badge.points} pts</p>
                              </div>
                            </div>
                            {playersWithBadge.length > 0 && (
                              <div className="text-white/60 text-xs mt-2 pt-2 border-t border-white/20">
                                <p>Obtenu par: {playersWithBadge.length} joueur(s)</p>
                                <p className="truncate">{playersWithBadge.slice(0, 3).join(', ')}{playersWithBadge.length > 3 ? '...' : ''}</p>
                              </div>
                            )}
                          </div>
                        );
                      })}
                    </div>
                  </div>

                  {/* Badges Collectifs */}
                  <div className="bg-white/10 backdrop-blur-sm rounded-xl p-6">
                    <h2 className="text-2xl font-bold text-white mb-6 text-center">ğŸ  Badges Collectifs</h2>
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
                      {Object.values(collectiveBadges).map(badge => {
                        // Compter combien de franchises ont ce badge
                        const franchisesWithBadge = Object.entries(franchiseBadges).filter(([franchise, badges]) =>
                          badges?.some(b => b.id === badge.id)
                        ).map(([franchise]) => franchise);

                        return (
                          <div key={badge.id} className={`rounded-lg p-4 border-2 ${getRarityColor(badge.rarity)}`}>
                            <div className="flex items-center space-x-3 mb-3">
                              <span className="text-4xl">{badge.emoji}</span>
                              <div className="flex-1">
                                <h3 className="text-white font-bold text-lg">{badge.name}</h3>
                                <p className="text-white/70 text-sm">{badge.description}</p>
                                <p className="text-yellow-300 text-xs mt-1">+{badge.points} pts franchise</p>
                              </div>
                            </div>
                            {franchisesWithBadge.length > 0 && (
                              <div className="text-white/60 text-xs mt-2 pt-2 border-t border-white/20">
                                <p>Obtenu par: {franchisesWithBadge.join(', ')}</p>
                              </div>
                            )}
                          </div>
                        );
                      })}
                    </div>
                  </div>
                </div>
              </div>
            );
          }
// PAGE DES GRADES
if (currentView === 'grades') {
  // DÃ©finition complÃ¨te de tous les grades
  const allGrades = [
    // GRADES NÃ‰GATIFS
    { emoji: 'ğŸ—‘ï¸', name: 'Scrub', minScore: -1000, maxScore: -50, color: 'from-red-900 to-red-700', description: 'Le pire niveau possible' },
    { emoji: 'ğŸª‘', name: 'Benchwarmer', minScore: -50, maxScore: -25, color: 'from-red-700 to-red-500', description: 'ClouÃ© sur le banc' },
    { emoji: 'ğŸ“‰', name: 'Plot', minScore: -25, maxScore: 0, color: 'from-gray-700 to-gray-500', description: 'Personnage sans importance' },
    
    // GRADES DÃ‰BUTANTS
    { emoji: 'ğŸ‘¶', name: 'Freshman', minScore: 0, maxScore: 10, color: 'from-yellow-600 to-yellow-500', description: 'PremiÃ¨re annÃ©e, apprend les bases' },
    { emoji: 'ğŸ€', name: 'Rookie', minScore: 10, maxScore: 25, color: 'from-amber-600 to-amber-500', description: 'DÃ©butant prometteur' },
    
    // GRADES DÃ‰VELOPPEMENT
    { emoji: 'ğŸƒ', name: 'Sixth Man', minScore: 25, maxScore: 50, color: 'from-green-700 to-green-600', description: 'Premier remplaÃ§ant de qualitÃ©' },
    { emoji: 'â­', name: 'Starting Five', minScore: 50, maxScore: 75, color: 'from-green-600 to-green-500', description: 'Titulaire indiscutable' },
    
    // GRADES CONFIRMÃ‰S
    { emoji: 'ğŸ’', name: 'Franchise Player', minScore: 75, maxScore: 100, color: 'from-blue-700 to-blue-600', description: 'Pilier de l\'Ã©quipe' },
    { emoji: 'ğŸŒŸ', name: 'All-Star', minScore: 100, maxScore: 150, color: 'from-blue-600 to-blue-500', description: 'SÃ©lectionnÃ© parmi l\'Ã©lite' },
    
    // GRADES Ã‰LITE
    { emoji: 'ğŸ”¥', name: 'Superstar', minScore: 150, maxScore: 200, color: 'from-orange-600 to-red-500', description: 'PhÃ©nomÃ¨ne basketball' },
    { emoji: 'ğŸ›ï¸', name: 'Hall of Fame', minScore: 200, maxScore: 250, color: 'from-yellow-600 to-yellow-500', description: 'LÃ©gende du sport' },
    
    // GRADE ULTIME
    { emoji: 'ğŸ', name: 'GOAT', minScore: 250, maxScore: 9999, color: 'from-purple-600 to-pink-600', description: 'Greatest Of All Time' }
  ];

  // Compter combien d'Ã©lÃ¨ves ont chaque grade
  const getPlayersInGrade = (minScore, maxScore) => {
    return players.filter(p => p.score >= minScore && p.score < maxScore).length;
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 p-8">
      <div className="max-w-7xl mx-auto">
        <div className="flex justify-between items-center mb-8">
          <h1 className="text-4xl font-bold text-white">ğŸ€ SystÃ¨me de Grades Basketball</h1>
          <button
            onClick={() => setCurrentView(userType === 'teacher' ? 'teacher-dashboard' : 'student-dashboard')}
            className="bg-gray-600 hover:bg-gray-500 text-white px-6 py-3 rounded-lg transition-colors"
          >
            â† Retour
          </button>
        </div>

        {/* Progression visuelle */}
        <div className="bg-white/10 backdrop-blur-sm rounded-xl p-6 mb-8">
          <h2 className="text-2xl font-bold text-white mb-6 text-center">ğŸ¯ Ã‰chelle de Progression</h2>
          <div className="relative">
            {/* Barre de progression */}
            <div className="absolute left-0 right-0 top-1/2 h-2 bg-white/20 rounded-full transform -translate-y-1/2"></div>
            
            {/* Points clÃ©s */}
            <div className="relative flex justify-between mb-8">
              <div className="text-center">
                <div className="w-4 h-4 bg-red-500 rounded-full mb-2"></div>
                <div className="text-white text-xs">-50</div>
              </div>
              <div className="text-center">
                <div className="w-4 h-4 bg-yellow-500 rounded-full mb-2"></div>
                <div className="text-white text-xs">0</div>
              </div>
              <div className="text-center">
                <div className="w-4 h-4 bg-green-500 rounded-full mb-2"></div>
                <div className="text-white text-xs">50</div>
              </div>
              <div className="text-center">
                <div className="w-4 h-4 bg-blue-500 rounded-full mb-2"></div>
                <div className="text-white text-xs">100</div>
              </div>
              <div className="text-center">
                <div className="w-4 h-4 bg-orange-500 rounded-full mb-2"></div>
                <div className="text-white text-xs">150</div>
              </div>
              <div className="text-center">
                <div className="w-4 h-4 bg-purple-500 rounded-full mb-2"></div>
                <div className="text-white text-xs">250+</div>
              </div>
            </div>
          </div>
        </div>

        {/* Liste des grades */}
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          {allGrades.map((grade, index) => {
            const playersCount = getPlayersInGrade(grade.minScore, grade.maxScore);
            const isNegative = grade.minScore < 0;
            
            return (
              <div 
                key={index} 
                className={`bg-gradient-to-r ${grade.color} p-6 rounded-xl shadow-2xl transform hover:scale-105 transition-all duration-300`}
              >
                <div className="text-center">
                  <div className="text-6xl mb-3">{grade.emoji}</div>
                  <h3 className="text-2xl font-bold text-white mb-2">{grade.name}</h3>
                  <p className="text-white/90 mb-3">{grade.description}</p>
                  
                  <div className="bg-black/30 rounded-lg p-3 mb-3">
                    <div className="text-white font-bold">
                      {grade.maxScore === 9999 ? 
                        `${grade.minScore}+ points` : 
                        `${grade.minScore} Ã  ${grade.maxScore} points`
                      }
                    </div>
                  </div>
                  
                  {userType === 'teacher' && (
                    <div className="text-white/80 text-sm">
                      {playersCount > 0 ? (
                        <span className="font-bold">{playersCount} Ã©lÃ¨ve{playersCount > 1 ? 's' : ''}</span>
                      ) : (
                        <span className="text-white/50">Aucun Ã©lÃ¨ve</span>
                      )}
                    </div>
                  )}
                  
                  {isNegative && (
                    <div className="mt-2 text-red-200 text-xs">
                      âš ï¸ Zone de danger
                    </div>
                  )}
                </div>
              </div>
            );
          })}
        </div>

        {/* Statistiques pour les profs */}
        {userType === 'teacher' && (
          <div className="mt-8 bg-white/10 backdrop-blur-sm rounded-xl p-6">
            <h3 className="text-2xl font-bold text-white mb-4">ğŸ“Š RÃ©partition Actuelle</h3>
            <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
              <div className="text-center">
                <div className="text-3xl font-bold text-red-400">
                  {players.filter(p => p.score < 0).length}
                </div>
                <div className="text-white/70">En difficultÃ©</div>
              </div>
              <div className="text-center">
                <div className="text-3xl font-bold text-yellow-400">
                  {players.filter(p => p.score >= 0 && p.score < 50).length}
                </div>
                <div className="text-white/70">DÃ©butants</div>
              </div>
              <div className="text-center">
                <div className="text-3xl font-bold text-green-400">
                  {players.filter(p => p.score >= 50 && p.score < 150).length}
                </div>
                <div className="text-white/70">ConfirmÃ©s</div>
              </div>
              <div className="text-center">
                <div className="text-3xl font-bold text-purple-400">
                  {players.filter(p => p.score >= 150).length}
                </div>
                <div className="text-white/70">Ã‰lite</div>
              </div>
            </div>
          </div>
        )}
      </div>
    </div>
  );
}
          // Return principal avec le modal d'historique et notifications
          return (
            <>
              {/* SystÃ¨me de notifications */}
              <NotificationSystem notifications={notifications} />
              
              {selectedPlayerHistory && (
                <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
                  <div className="bg-white rounded-xl p-6 max-w-md w-full max-h-96 overflow-y-auto">
                    <div className="flex justify-between items-center mb-4">
                      <h3 className="text-xl font-bold">Historique de {selectedPlayerHistory}</h3>
                      <button
                        onClick={() => setSelectedPlayerHistory(null)}
                        className="text-gray-500 hover:text-gray-700 text-xl"
                      >
                        Ã—
                      </button>
                    </div>
                    <div className="space-y-2">
                      {playerHistory.length > 0 ? (
                        playerHistory.map((entry, index) => (
                          <div key={index} className="border-l-4 border-blue-500 pl-3 py-2">
                            <div className="font-semibold">{entry.action}</div>
                            <div className="text-sm text-gray-600">
                              {entry.points > 0 ? '+' : ''}{entry.points} points
                            </div>
                            <div className="text-xs text-gray-500">
                              {entry.timestamp} â€¢ Total: {entry.new_total} pts
                              {entry.teacher_name && entry.teacher_name !== 'Anonyme' && (
                                <span> â€¢ Par: {entry.teacher_name}</span>
                              )}
                            </div>
                          </div>
                        ))
                      ) : (
                        <p className="text-gray-500 text-center">Aucun historique disponible</p>
                      )}
                    </div>
                  </div>
                </div>
                {showProgressionChart && selectedChartPlayer && (
  <ProgressionChart 
    playerName={selectedChartPlayer}
    onClose={() => {
      setShowProgressionChart(false);
      setSelectedChartPlayer(null);
      }}
    />
  )}
    
               )}
            </>
          );
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
